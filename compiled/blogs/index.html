<!DOCTYPE html>
<html lang="en" xmlns:wb=“http://open.weibo.com/wb”>
  <head>
    <meta charset="utf-8">
    <title>Blogs</title>
    <meta name="description" content="博客summary">
    <meta name="author" content="tiemei">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css?0.3656549763171778" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css?0.8861534753011808" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css?0.24919318376397492" type="text/css" rel="stylesheet" media="all">

 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">tiemei</a>
          <ul class="nav">
              
                <li><a href="/categories">Categories</a></li>
              
                <li><a href="/tools">Tools</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>Blogs </h1>
</div>

<div class="row">
  <div class="span12">
    <h2>Latest Posts</h2>

<div class="post">
  <h3 class="title"><a href="/2014-04/node-js-and-division-of-work.html">Node.js前后端分离在广告页面中的思考</a> <span class="date">2014-04-20</span></h3>

  <p>撇下Node.js社区的红火，异步I/O的相比阻塞I/O的好处，也不谈回调嵌套是否反人类，Node.js是否在“羞辱”后端程序员，我想借着这篇文字理一下Node.js在我们广告页面中能否提高合作效率和迭代速度。  </p>

<h3 id="toc_0">过去和现状</h3>

<p>我们团队维护直通车、外投外、无线等多条产品线的二跳页面，且正在接入一跳广告位。  </p>

<p>2012年我刚来团队的时候，说的简单点，主要做的事情无非就是从广告引擎、其他数据源获取数据，展示到页面上。因为公司技术环境的原因，最开始选择了webx+velocity模板，由前端工程师写静态的html页面，java工程师拿过来，把其中的动态部分用vm模板语言重写一遍，再从后端数据源把数据拿过来，几乎不会对数据进行更多的逻辑加工。加上页面几乎没有用户输入部分，基本上交互都集中在纯js/css动态效果，ajax异步数据请求和展现（没有数据输入）。  </p>

<p>可以看到这样的合作模式里，前端/后端工程师的分工是非常明确和解耦的，当然前端同学也能在这样的模式下积累可重用的js组件提交效率。但，随着粗放式增长的瓶颈，加上内部流程的制约，这样的迭代方式遇到了问题？首先，经常性的页面局部调整一般只能在下周的发布日才能完成；一次无法尝试过多版本，因为开发html改成动态模版和测试都需要资源；重复的页面模块开发；后端工程师一直在干重复枯燥的劳动，没有精力去思考如何做到流程的自动化、数据可反馈、统一解决方案的问题；当然还有多终端时代的挑战。  </p>

<p>我们做的第一次尝试，“组件化”平台，我认为实际上是做到页面搭建过程的模型化，也就是说用一种统一的模型来描述页面的逻辑，进而用线上可动态改变的配置文件来描述这个模型。显然，在后端工程师的角度，我们不再是写写数据接口，写写页面模版了，我们面对统一的页面模型，进行配置的统一生成和解析。这里可以简单说下这个模型，基于广告页面的实际业务场景，我们把页面切分成几个独立的块，每块用“动态模版+数据源配置+样式js”的方式描述，块之间的js,css依赖通过css class命名规范进行解耦，块之间的数据依赖（这样的依赖极少）通过配置上的数据传递来解决。  </p>

<p>“组件化”平台的配置化的统一模型尝试是突破性的，后端开发终于从将html改写成动态模版这样的无聊的工作中解脱了，我们也似乎看到一点平台化的统一解决方案的影子。但，因为这个配置化的模型还是过于复杂了，生成模型配置的管理系统，提供出来的配置界面(<code>http://moc.taobao.org/</code>)过于复杂，也注定了它只能给开发自己玩玩。更大的问题是，<strong>前端工程师需要写后端动态模板</strong>，调试是个大问题呀！前端们用node.js+velocity.js搭了一个调试平台，然后再用约定的接口数据格式，自己定义一些mock数据调试。这样的方式勉强可以跑通，但前端开发完页面的动的模块后，需要后端工程师在配置系统配置上数据接口和模块之间的依赖关系，然后再将模块代码上传到后端渲染系统，然后才能看到真正的动态页面长什么样。这样的合作方式，我们做出来的页面已经覆盖到淘客、直通车、外投外、淘星云等多个页面，流量也上千万了。如此多的依赖，和前端对最终运行环境的无法感知，带来不少坎坷和诡异的问题。  </p>

<h3 id="toc_1">“组件化”方案中前后端到底哪里耦合</h3>

<p>首先再反思下，我们现有的前后端解耦手段：  </p>

<ol>
<li>数据接口输出预先约定好</li>
<li>Node.js + velocity.js 搭建前端开发调试环境</li>
<li>前端控制动态模版的编写和css/js的控制</li>
<li>后端控制数据接口入参的控制，数据接口的准备，页面模块间依赖的配置，
最终配置的解析和渲染输出</li>
</ol>


  <div class="more">
    <a href="/2014-04/node-js-and-division-of-work.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2014-01/reading-linux-101-hacks.html">《linux 101 hacks》笔记</a> <span class="date">2014-01-18</span></h3>

  <h2 id="toc_0">cd</h2>

<p><strong>CDPATH</strong>  </p>

<p>默认<code>cd logs</code>进入当前目录的logs目录，设置了这个变量，优先进入这个变量
指向的目录的下对应的文件夹。可用冒号分隔指定多个。  </p>

<p><strong>返回多级上级目录</strong>  </p>

<pre><code>~/.bashrc

alias ..=&#39;cd ..&#39;
alias ..2=&#39;cd ../..&#39;
alias ..3=&#39;cd ../../..&#39;

或者这种方式：
</code></pre>


  <div class="more">
    <a href="/2014-01/reading-linux-101-hacks.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-11/linux-software-install.html">谈谈Unix-like上软件安装那些事</a> <span class="date">2013-11-10</span></h3>

  <h2 id="toc_0">Linux和Mac OS X</h2>

<p>在大学刚听说linux时候，被一堆名词唬住了：CentOS,Ubuntu,RedHat等。我一开始用
Fedora13一直用到Fedora15，使用过程中遇到多次诡异问题，最后都定位到是Fedora发行
版的bug，变忍痛弃之。相对，使用率更高的Ubuntu成为我的第二选择，因为使用率高，出现
问题也能从网上获得更多帮助。从今年3月份开始，换成了现在的os x系统。<br>
如此多的选择，常常让入门者无所适从。<br>
linux发行版分为主要的三个分支：RedHat、Slackware和Debian，每一个分支都拥有一个
最具代表性的商业服务器级的发行版，它们是：RedHat Enterpries Linux，简称RHEL、
SUSE LinuxEnterprise，简称SUSE，和Ubuntu Server，简称Ubuntu。有分支的区分，是因为
后来的各种发行版是在这几个最初版本上修改而来的，虽然某些发行版实际上已经跟最初的
版本相差甚远了。很多大型互联网公司会选择REHL，因为它对kvm的支持。但REHL收费，除非
你自己下它的源码编译，不过CentOS就是REHL源码编译过来的，所以，直接上CentOS就好。<br>
那现在苹果机器搭载的os x系统处在什么位置呢？<code>Mac OS</code>基于Mach内核，这个内核的出现也是
为了弥补Unix的某些局限和不足，对Unix系统下的程序的直接移植也做到了较好的兼容性。<code>mac os x</code>
是一次内核层面的改造，核心名为<code>Darwin</code>，以<code>FreeBSD</code>源码和<code>Mach</code>微内核为基础。于是可知现在
我们使用的<code>Mac os x</code>衍生自<code>BSD</code>分支，而linux于1991被<code>Linus Benedict Torvalds</code>编写时，<code>386BSD</code>
还没有发布。如果真的要追溯linux和<code>mac os x</code>的血缘关系，恐怕要更远了。所以，如果你觉得
用惯了Ubuntu，换成Mac机有一些不习惯，那是不可避免的了。  </p>


  <div class="more">
    <a href="/2013-11/linux-software-install.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-09/jvm-class-loader-and-init.html">JVM——类加载器，初始化</a> <span class="date">2013-09-15</span></h3>

  <h1 id="toc_0">类加载器</h1>

<h2 id="toc_1">“双亲”委派</h2>

<ol>
<li><p>类加载器使用“双亲委派”模型。
<img src="http://farm4.staticflickr.com/3705/9757201665_47321648aa.jpg" alt="classloaders"></p></li>
<li><p>可以自己写一个类编辑打成Jar包放到<code>$JAVA_HOME/jre/lib/ext</code>目录，再写一个启动类，
打印出加载所写类的classloader，发现是extclassloader。但是放到<code>$JAVA_HOME/jre/lib</code>
目录并不会被加载</p></li>
<li><p>被加载的类唯一标识是类路径+类加载器id.</p></li>
</ol>

<h2 id="toc_2">线程类加载器</h2>

<p>首先介绍一个概念：<strong>当前类加载器</strong>，指当前方法方法所在类的加载器。<code>Class.forName(String)</code>
<code>Class.getResource(String)</code><code>X.class</code>都是用的当前类加载器。<br>
这是原有的“双亲委派”模型就不能解决问题了。例如JNDI的核心类在JRE的rt.jar中，而这些核心类
需要加载第三方厂商的JNDI实现，加载时的类加载器默认是“当前类加载器”，即<code>Bootstrap class loader</code>，
显然是加载不到这些实现类的。这时，<strong>线程类加载器</strong>就起作用了。让JNDI核心类的加载使用线程
上下文类加载器，打破“双亲委托”限定的向上代理机制。<br>
虽然下“线程类加载器”解决了某些特殊问题，但它也存在不足。除非所有线程使用同一个线程上下文类
加载器，否则它们的数据共享成为问题。并且，缺省规则为使用当前类加载器，有些代码你又没法控制，
这个问题变得更加复杂。  </p>


  <div class="more">
    <a href="/2013-09/jvm-class-loader-and-init.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-09/maven-cmd.html">常用maven命令</a> <span class="date">2013-09-12</span></h3>

  <h2 id="toc_0">剪裁反应堆</h2>

<ul>
<li>构建指定几个模块<code>mvn clean install -pl account-email,account-persist</code> </li>
<li>构建指定模块及其依赖<code>mvn clean install -pl account-email -am</code></li>
<li>构建指定模块及依赖它的模块<code>mvn clean install -pl account-email -amd</code></li>
<li>在完整的反应对顺序上指定从哪个模块开始构建<code>mvn clean install -rf account-email</code></li>
<li>在<code>-pl -am / -pl -amd</code>基础上还能用<code>-rf</code>再次剪裁</li>
</ul>

<h2 id="toc_1">常用命令</h2>

<p>新建一个空白工程  </p>

<pre><code>mvn archetype:create -DgroupId=com.tiemei -DartifactId=p1 -DpackageName=com.tiemei.p1
建web工程加-DarchetypeArtifactId=maven-archetype-webapp
</code></pre>


  <div class="more">
    <a href="/2013-09/maven-cmd.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-08/java-locks.html">java锁笔记</a> <span class="date">2013-08-30</span></h3>

  <h1 id="toc_0">线程通信</h1>

<p>通信遇到的问题包括：  </p>

<ol>
<li>共享对象：需要做同步处理</li>
<li>忙等待：循环等待另一个线程发来信号，可sleep</li>
<li><p>wait(),notify()</p>

<pre><code>1. 遇到mobj.wait()，让线程进入非运行状态，直到另一个线程mobj.nitify
2. 这几个方法必须在获得mobj锁的前提下调用，否则IllegalMonitorStateException
3. 一个线程调用了wait()，即释放mobj上的锁
4. 一旦一个线程被唤醒，不能立刻就退出wait()的方法调用，直到调用
notify()的线程退出了它自己的同步块。因此，多个线程被notifyAll唤醒，只有一个
线程可以最终退出wait()方法，因为必须获得mobj的锁
</code></pre></li>
</ol>


  <div class="more">
    <a href="/2013-08/java-locks.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-08/jdk-tools.html">jdk自带工具</a> <span class="date">2013-08-30</span></h3>

  <h1 id="toc_0">javah</h1>

<h2 id="toc_1">JNI示例</h2>

<p>参考:<a href="https://blogs.oracle.com/moonocean/entry/a_simple_example_of_jni">JNI example</a>  </p>

<ol>
<li>写一个java类，生命navtive方法</li>
<li>调用javah生成头文件</li>
<li>写c代码，生成库文件</li>
<li><code>java -Djava.library.path=&lt;path_of_native_lib&gt; JNIFoo</code>会默认先载入头文件，
然后按指定的路径查找库文件</li>
</ol>

<h1 id="toc_2">jmap(Java Memory Map)</h1>

<p>参考:<a href="http://blog.csdn.net/fenglibing/article/details/6411953">jmap</a>  </p>

<h2 id="toc_3">jmap -histo pid</h2>

<p><img src="http://farm8.staticflickr.com/7346/9627329472_b28eba137c.jpg" alt="jmap output"></p>


  <div class="more">
    <a href="/2013-08/jdk-tools.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-06/ssh.html">ssh密钥自动登陆+ssh-agent使用+单机多个ssh账号</a> <span class="date">2013-06-30</span></h3>

  <p>参考：<br>
<a href="http://www.lainme.com/doku.php/blog/2011/01/%E4%BD%BF%E7%94%A8ssh_config#%E7%94%9F%E6%88%90ssh%E8%AF%81%E4%B9%A6">使用SSH CONFIG</a><br>
<a href="http://7056824.blog.51cto.com/69854/403669/">使用ssh公钥密钥自动登陆linux服务器</a>  </p>

<h2 id="toc_0">生成ssh key</h2>

<p><code>ssh -t rsa</code><br>
<code>ssh -t rsa -C &quot;jiadongkai@gmail.com&quot;</code> 注释用邮箱地址<br>
将公钥追加到需要登录机器的~/.ssh/authorized<em>keys，如果无法登陆将~/.ssh/known</em>hosts
对应行删掉<br>
注意需要保证authorized_keys文件只有当前用户有写权限  </p>

<h2 id="toc_1">用ssh-agent省掉passphrase输入</h2>

<ol>
<li>准备ssh-agent需要的环境变量，选择下面的一种方法即可<br></li>
</ol>


  <div class="more">
    <a href="/2013-06/ssh.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-06/about-bashrc.html">.bashrc .bash_profile等文件区别</a> <span class="date">2013-06-28</span></h3>

  <p><strong>/etc/profile</strong><br>
全局，用户第一次登录执行一次<br>
会从/etc/profile.d目录的配置文件中搜集shell的设置.</p>

<p><strong>/etc/bashrc</strong><br>
全局，bash shell配置，一般由/etc/profile调用  </p>

<p><strong>~/.bash_profile</strong><br>
似有，用户登录(ssh远程登陆/本地新开一个terminal)时执行一次
一般会调用~/.bashrc  </p>

<p><strong>~/.bashrc</strong><br>
似有，每次执行bash命令时自动调用，或者非交互方式进入bash时运行  </p>


  <div class="more">
    <a href="/2013-06/about-bashrc.html" class="btn">read more..</a>
  </div>
</div>

<div class="post">
  <h3 class="title"><a href="/2013-06/svn-git-cmds.html">我的svn git常用命令及配置</a> <span class="date">2013-06-27</span></h3>

  <p>参考:<br>
<a href="http://blog.csdn.net/sunboy_2050/article/details/6187464">SVN常用命令</a><br>
<a href="http://www.subversion.org.cn/svnbook/1.4/svn.ref.svn.c.diff.html">svn diff</a>  </p>

<h2 id="toc_0">svn</h2>

<h3 id="toc_1">常用命令</h3>

<ul>
<li><code>svn co remote-svn-path local-dir --username tiemei</code>签出</li>
<li><code>svn cp base-svn-path new-svn-path -m &quot;commit log&quot;</code>新建分支</li>
<li><code>svn diff -r m path/file</code> 比较工作拷贝和某个版本的区别</li>
<li><code>svn diff -c m path/file</code> 查看某个版本修改的内容</li>
<li><code>svn diff --diff-cmd /usr/bin/diff -x &quot;-i -b&quot; COMMITTERS</code> 指定外部diff程序 </li>
<li><code>svn diff -r m:n path</code> 比较两个版本文件差异</li>
<li><code>svn diff -r m:n path |grep &quot;Index:&quot;</code> 比较两个版本间变化的文件</li>
<li><code>svn info path</code> 列出某个path svn信息</li>
<li><code>svn log path</code> 查看path提交log</li>
<li><code>svn log -l4</code>  查看前四个提交log</li>
<li><code>svn ls path</code>  列出某个路径下内容(与远程交互)</li>
<li><code>svn mkdir path</code> 远程增加某个path</li>
<li><code>svn cat /path/to/file</code> 打印某个文件内容</li>
<li><code>svn st path</code> 只输出状态有变化的文件</li>
<li><code>svn st -v path</code> 列出所有文件详细状态信息</li>
<li><code>svn add file/dir</code><code>svn ci m &quot;comment log&quot;</code> 添加文件，提交变动</li>
<li><code>svn rm path/file</code> 移除某个分支/文件</li>
<li><code>svn merge URL local_dir/url</code>合并分支，先将原分支cm，然后merge到本地新开发分支，
或者merge到远程svn新分支</li>
</ul>


  <div class="more">
    <a href="/2013-06/svn-git-cmds.html" class="btn">read more..</a>
  </div>
</div>

  </div>
</div>

      </div>

      <footer>
        <p>&copy; tiemei 2012 
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
        <p>
        <script src="http://s9.cnzz.com/stat.php?id=5379369&web_id=5379369&online=1&show=line" language="JavaScript"></script>
        </p>
      </footer>

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    <script>
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(defworld.com);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/defworld.comns.gif" /></p></noscript>
  </body>
</html>
