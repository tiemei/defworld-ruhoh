---
title: 关系型数据库笔记
date: '2014-12-05'
description: 
categories: 'DB'
---

# 1NF 2NF 3NF ...

范式（NF）：一张数据表的表结构所符合的某种设计标准的级别。要求逐级提高，而高级的同时满足低级的。  

## 1NF

![1NF](https://farm9.staticflickr.com/8616/15925324316_09846f9765_z.jpg) 

如上图进货和销售又细分了属性，不满足1NF。  
每个属性都不可再分。因为真实的DB每列都不可再分的，所以能存到真实DB里就说明满足1NF。

## 2NF

![2NF](https://farm8.staticflickr.com/7495/15786427597_96178e86ab.jpg)  

如上图，满足1NF，但存在以下问题：  

1. 每一名学生的学号、姓名、系名、系主任这些数据重复多次。每个系与对应的系主任的数据也重复多次——**数据冗余过大**
2. 新建一个系，无法将系名与系主任的数据单独添加到数据库——**插入异常** 
3. 删除某个系所欲学生记录，这个系的数据被删除掉 —— **删除异常** 
4. 某同学转系，需要修改三条记录 —— **修改异常** 

先介绍几个概念:  

* 码：K为某表的一个属性或属性组，它是唯一的，即其他属性完全函数依赖于K，称K为候选码，简称码。选择其中一个作为主码
* 函数依赖：一张表中，在属性（或属性组）X值确定的情况下，必能能确定属性Y的值，那么就可以说Y函数依赖于X
* 完全函数依赖：若Y函数依赖X，且对于X的任何一个真子集X'（假如属性组X包含超过一个属性的话），Y函数依赖于X'不成立，称Y对X完全函数依赖。

        （学号，课名） F→ 分数 （注：因为同一个的学号对应的分数不确定，同一个课名对应的分数也不确定）

* 部分函数依赖：不完全函数依赖时反过来就是部分函数依赖。
* 传递函数依赖：假如 Z 函数依赖于 Y，且 Y 函数依赖于 X （严格来说还有一个X 不包含于Y，且 Y 不函数依赖于Z的前提条件），那么我们就称 Z 传递函数依赖于 X 
* 非主属性：包含在任何一个码中的属性成为主属性

2NF定义：2NF在1NF的基础之上，消除了非主属性对于码的部分函数依赖。判断步骤：  

* 第一步：找出数据表中所有的码。
* 第二步：根据第一步所得到的码，找出所有的主属性。
* 第三步：数据表中，除去所有的主属性，剩下的就都是非主属性了。
* 第四步：查看是否存在非主属性对码的部分函数依赖。  

![2NF-2](https://farm9.staticflickr.com/8619/15784930058_d21ff87fe3.jpg)  

```
码：（学号、课名）
主属性有两个：学号 与 课名
非主属性有四个：姓名、系名、系主任、分数

对于（学号，课名） → 姓名，有 学号 → 姓名，存在非主属性 姓名 对码（学号，课名）的部分函数依赖。
对于（学号，课名） → 系名，有 学号 → 系名，存在非主属性 系名 对码（学号，课名）的部分函数依赖。
对于（学号，课名） → 系主任，有 学号 → 系主任，存在非主属性 对码（学号，课名）的部分函数依赖。

所以表3存在非主属性对于码的部分函数依赖，最高只符合1NF的要求，不符合2NF的要求。
```

那就要进行模式分解，分解成下面两个表：  

```
选课（学号，课名，分数）
学生（学号，姓名，系名，系主任）
```

新的函数依赖图：  

![2NF-3]()  

满足了2NF，还是存在一些问题：  

* 删除某个系中所有的学生记录：该系的信息仍然全部丢失。——无改进
* 插入一个尚无学生的新系的信息：因为学生表的码是学号，不能为空，所以此操作不被允许。——无改进

## 3NF

3NF在2NF的基础之上，消除了非主属性对于码的传递函数依赖。  

对于选课表，主码为（学号，课名），主属性为学号和课名，非主属性只有一个，为分数，不可能存在传递函数依赖，所以选课表的设计，符合3NF的要求。

对于学生表，主码为学号，主属性为学号，非主属性为姓名、系名和系主任。因为 学号 → 系名，同时 系名 → 系主任，所以存在非主属性系主任对于码学号的传递函数依赖，所以学生表的设计，不符合3NF的要求。。

进一步模式分解：  

```
选课（学号，课名，分数）
学生（学号，姓名，系名）
系（系名，系主任）
```


# How to Store a Tree?

## 邻接表



## 枚举路径

## 嵌套集

## 闭包表

参考:  

[知乎：解释一下关系数据库的第一第二第三范式？](http://www.zhihu.com/question/24696366)    


